from pwn import *
import random
import json
# public numbers from server
prime_p = 136062877477772021443963986821466822423928306636725705955189295265171531194630539497933022412421177627488716473227275120023271715397034546804175879349877168981582602251424924699340785448683074807806407936267383798949594772365085169340683942944085482956202789355681500477966677233789310292180313638378062381719
prime_q = 68031438738886010721981993410733411211964153318362852977594647632585765597315269748966511206210588813744358236613637560011635857698517273402087939674938584490791301125712462349670392724341537403903203968133691899474797386182542584670341971472042741478101394677840750238983338616894655146090156819189031190859
generator = 68695322546411990097618816719880607069395444393834268960741680054974511660271970026150039567236118658479679444015844573677880347686810169165388385685914903968147097279757787122753390447954112451193808647256026282821032909814441591222220915875289906762225085266354556177943238500761050758957943922408034634359

# from pcap, reused nonce -> x value is the same in two distinct exchanges
c1 = 11984018478493650397575451106161092930826654232450558673452070898749202182493853803262398930041131145626253556612472802849125963362961532704017877362624791
y1 = 51828397519016285117477698009659366845757274882099916718923577778007674640516094192605688359302758372459448783859773218034750383374812537565196178811037269658901530004792610789845245130041315213014489826711595223142765944575585994252704573504461100662436217124379763582827818867723210537335787823542169195425

c2 = 6346456475943905653773152348482674490556560821181130536805957031576438064068418781139025295567392945091754174764384354765866836772227550306755247625676364
y2 = 19559728819285470501734041782152146782018289863450937761628737300501110079222583987911487187627794296060112567634724730075969333911486534761912216071936476958564765280417028984918431193379675522397536373376339945016805781624943823114643382943179116437882684871656591955078020023366882601630263651355691776674

x1 = y1 - y2
x2 = c1 - c2

# x1 / x2 (mod q) = x1 * (x2**(-1)) (mod q)
privkey = (x1 * pow(x2,-1,prime_q)) % prime_q

r = random.randrange(prime_q-1)

conn = remote("34.107.92.149",2538)
conn.recvline()
x = pow(generator,r,prime_p)
x = {'x' : x }
x = json.dumps(x)
conn.sendline(x)

challenge = json.loads(conn.readline())["c"]

y = (r + privkey*challenge) % prime_q
y = {'y' : y }
y = json.dumps(y)
conn.sendline(y)
print(conn.recvuntil(b"}"))
conn.close()
